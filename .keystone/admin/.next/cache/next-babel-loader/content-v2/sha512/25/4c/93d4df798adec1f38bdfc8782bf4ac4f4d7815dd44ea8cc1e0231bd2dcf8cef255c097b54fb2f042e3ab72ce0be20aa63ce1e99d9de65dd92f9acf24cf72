{"ast":null,"code":"import { createAuth } from '@keystone-next/auth';\nimport { config, createSchema } from '@keystone-next/keystone/schema';\nimport { withItemData, statelessSessions } from '@keystone-next/keystone/session';\nimport 'dotenv/config';\nimport { User } from './schemas/User';\nimport { Brand } from './schemas/Brand';\nimport { Category } from './schemas/Category';\nimport { Product } from './schemas/Product';\nimport { CartItem } from './schemas/CartItem';\nimport { ProductImage } from './schemas/ProductImage';\nimport { CategoryImage } from './schemas/CategoryImage';\nimport { sendPasswordResetEmail } from './lib/mail';\nimport { extendGraphqlSchema } from './mutations';\nconst databaseURL = process.env.MONGODB_URI || 'mongodb://localhost/keystone-phone-store';\nconst sessionConfig = {\n  maxAge: 60 * 60 * 24 * 360,\n  // How long they stay signed in?\n  secret: process.env.COOKIE_SECRET\n};\nconst {\n  withAuth\n} = createAuth({\n  listKey: 'User',\n  identityField: 'email',\n  secretField: 'password',\n  initFirstItem: {\n    fields: ['name', 'email', 'password'] // TODO: add initial roles her\n\n  },\n  passwordResetLink: {\n    async sendToken(args) {\n      // send the email\n      console.log(args);\n      await sendPasswordResetEmail(args.token, args.identity);\n    }\n\n  }\n});\nexport default withAuth(config({\n  server: {\n    cors: {\n      origin: [process.env.FRONTEND_URL],\n      credentials: true\n    }\n  },\n  db: {\n    adapter: 'mongoose',\n    url: databaseURL\n  },\n  lists: createSchema({\n    // schema items here\n    User,\n    Brand,\n    Category,\n    Product,\n    CartItem,\n    ProductImage,\n    CategoryImage\n  }),\n  extendGraphqlSchema,\n  ui: {\n    // Show the UI only for poeple who pass this test\n    isAccessAllowed: ({\n      session\n    }) => !!(session !== null && session !== void 0 && session.data)\n  },\n  session: withItemData(statelessSessions(sessionConfig), {\n    // GraphQL Query\n    User: 'id name email'\n  })\n}));","map":null,"metadata":{},"sourceType":"module"}